# この一冊で全部わかるサーバーの基本


<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [この一冊で全部わかるサーバーの基本](#この一冊で全部わかるサーバーの基本)
  - [01 サーバーとは](#01-サーバーとは)
  - [02 ネットワークの基礎知識](#02-ネットワークの基礎知識)
  - [03 サーバーを用意する](#03-サーバーを用意する)
  - [04 社内サーバーの基本](#04-社内サーバーの基本)
  - [05 公開サーバーの基本](#05-公開サーバーの基本)
  - [06 サーバーを障害から守る](#06-サーバーを障害から守る)
  - [07 サーバーのセキュリティ](#07-サーバーのセキュリティ)
  - [08 サーバーの運用管理](#08-サーバーの運用管理)

<!-- /code_chunk_output -->

## 01 サーバーとは
- サーバー：クライアントにいろいろなサービスを提供するコンピュータのこと
  - クライアントの例：webブラウザ
- クライアントから要求されて初めて、サーバーは処理を開始し、サービスを提供する（レスポンスを返す）：**クライアント／サーバーシステム**
  - クライアントがサーバーに何かしらのサービスを要求する
    - WebブラウザがWebサーバーに「このサイトのデータをください」と要求する
  - サーバーは要求に応じた処理を行う
    - Webサーバーがそのサイトのファイルを見つけ出す
  - サーバーは処理結果をクライアントに返す
    - WebサーバーがそのファイルをWebブラウザに渡す
  - クライアントは処理結果を受け取る
    - Webブラウザがそのファイルを受け取り、画面に表示する
- サーバーを構築するには？
  - コンピュータにソフトウェアをインストールして、起動すればよい
    - サーバーは、サーバーソフトウェアが持つ機能のこと。つまり、そのソフトウェアをインストールすれば、サーバーを使えるようになる
  - 1台のコンピュータに複数のサーバーを入れることはもちろん可能
    - ただし、そのコンピュータが壊れると、入っている全てのサーバーに影響があるというリスクも伴うことは忘れずに
- サーバーの種類とサーバーソフトウェアの選び方
  - どのサーバーを用意するか？は「何をしたいか？」による
    - メールを受信したいのに、Webサーバーをたてても意味がない
  - サーバーソフトウェアの選択肢は限られており、どれを選ぶかの問題
    - 対応しているOS、プログラミング環境、要求されている機能、ランニングコストなど、いろんな要素を比較して決める
- 運用と管理
  - 設定を変更したい、という全ての要求を聞き入れるわけにはいかないので、設定する範囲を決めたドキュメントなどを残しておくと、管理がしやすくなる
  - 障害対応
    - 事前対応
      - 日々のモニタリング、脆弱性情報やバグのチェックなど
    - 事後対応
      - サーバーのどこにどんな障害が起きたのかをログなどで確認し、適切な対応を行う
- ネットワークとの関係
  - サーバーとクライアントをつなぐのがネットワーク
  - ここでいうネットワークは「コンピューターネットワーク」のこと
    - インターネットやLANが身近なコンピューターネットワーク

## 02 ネットワークの基礎知識
- サーバーを接続する、無線LANはクライアント側だけのもの
- OSI参照モデル
  - 7層のやつ
![OSI](./images/osi.png)
  - 通信機能の役割を階層的に分類した概念
  - 
  - 各階層の役割は異なる。互いの動作に影響を与えることがないし、トラブルシューティングもしやすい。
  - 各層から各層への通信にはそれぞれのプロトコルがある
    - イーサネット、Wi-Fiは物理層からデータリンク層、IPはネットワーク層、など
  - 送信は上から下、受信は下から上
    - 実際の通信は、NIC（Network Interface Card, ネットワークアダプタ）のデバイスドライバーやOS、アプリケーションが各層で使用するプロトコルを選んで処理するが、自動で行なわれるので、ユーザが意識することはない
- プロトコル
  - ネットワークの世界において、通信する時の約束事
    - httpsとかね
  - プロトコルは、パケット（送りたいデータを分割したもの）の送り先、順番を定義する
    - プロトコルの送り先は「ヘッダー」で見分ける
- イーサネット：物理層とデータリンク層で必要不可欠な規格
  - イーサネットフレームを作って、LANケーブルに流す電気信号や、光ファイバに流す光信号に変換してケーブルに流す
- MACアドレス：コンピュータを識別する
  - NICに自動で割り当てられる
  - 48ビットを8ビットずつ、ハイフンやコロンで区切って16進数で表記する
    - 上位24ビット：IEEEが機器のベンダーごとに割り当てたベンダーコード：OUI（Organizationally Unique Identifier）と呼ばれる
    - 下位24ビット：ベンダー内で機器ごとに割り当てている一意のコード
  - コンピュータがデータを送信するときは自分のMACアドレスを「送信元MACアドレス」に、データを送る相手のMACアドレスを「あて先MACアドレス」としてヘッダーに入れる
- スイッチング：スイッチの行なうフレーム転送
  - イーサネットは「スイッチ」を中心として、コンピュータを配置していく「スター型トポロジー」という形態でコンピュータ同士を接続している
  - MACアドレステーブル：スイッチがスイッチングで使用するインターフェイス番号と送信元MACアドレスのテーブル
    - イーサネットワークにおける通信効率の向上を図る
![ethernet](./images/ethernet.png)
- IPアドレス：ネットワーク層で最も重要なプロトコル
  - IP：トランスポート層から受け取ったデータにIPヘッダーをくっつけてIPパケットにする
  - IPアドレスでコンピュータを識別する
  - サブネットマスクとセットで使う
    - 10進数表記とCIDR表記
      - .で区切るやつと、IPアドレスの後ろにスラッシュとサブネットマスクの「1」の個数を付与するやつ
  - ネットワーク部とホスト部（サブネットマスクで分割される）
    - ネットワークそのものと、ネットワークに接続しているコンピュータそのもの
- ルーティング：IPパケットをバケツリレーして、データを目的地まで届けること
  - イーサネットで作ったネットワークとネットワークをつなぐときに使用するネットワーク機器が「ルーター」
  - たくさんのルーターが網目状にネットワークを繋ぐことで、インターネットが成り立っている
  - IPパケットの受け渡し先は「ルーティングテーブル」で管理する
    - 宛先ネットワークとネクストホップ（あて先ネットワークに対する、送り先のIPアドレス）
  - 静的ルーティングと動的ルーティング
    - ルーティングテーブルを手動で管理するか、隣接するルーター間でルート情報を交換（ルーティングプロトコルというプロトコルが定められている）して、自動的にルーティングテーブルを作る
    - 小規模なネットワーク、中・大規模なネットワーク
- ARP（Adress Resolution Protocol）：物理（MACアドレス）と論理（IPアドレス）を関連づける
  - あて先MACアドレスを判別するために使われる
  - データを送るコンピュータがネットワーク層からIPパケットを受け取ると、パケットのあて先IPアドレスを見る
  - あて先が同じネットワークにいるコンピュータであれば、そのIPアドレスをARPで問い合わせ（ARPリクエスト）
    - その応答結果（ARPリプライ）をARPテーブルに登録し、それをもとにイーサネットフレームを作る
  - 異なるネットワークのコンピュータの場合、デフォルトゲートウェイ（自分以外のネットワークに行くときに使用する出口のIPアドレス（≒経由先））のMACアドレスをARPで問い合わせ、↑と同じ処理を行う
- TCPとUDP
  - データを大事にしっかりやり取りしたい時はTCP（Transmission Control Protocol）
    - 「送ったよ」「届いたよ」をきちんと確認しあう
    - Web、メール、ファイル共有など
  - データの信頼性は横に置いておいて、とにかく早く送りたい時はUDP(User Datagram Protocol)
    - 送ったら送りっぱなし
    - IP電話、動画配信、時刻同期など
  - ポート番号を見て、コンピュータの中のどのサービスにデータを渡せば良いかを識別する
    - ウェルノウンポート：0~1023
      - 一般的なサーバーソフトウェアがクライアントのサービス要求を待ち受けるときに使う
    - レジスタードポート：1024~49151
      - メーカー独自のサーバーソフトウェアがクライアントのサービス要求を待ち受けるときに使う
    - ダイナミックポート：49152~65535
      - サーバーがクライアントソフトウェアを識別するために使う
- ポート番号
  - コンピューターの中で動作しているアプリケーションを識別するために使う数字
- NATとNAPT
  - プライベートIPアドレスをグローバルIPアドレスに変換する技術
  - NAT：ネットワークアドレス変換
    - IPアドレスを1対1で変換する
  - NAPT：ネットワークアドレスポート変換
    - IPアドレスとポート番号を変換する
## 03 サーバーを用意する
## 04 社内サーバーの基本
## 05 公開サーバーの基本
## 06 サーバーを障害から守る
## 07 サーバーのセキュリティ
## 08 サーバーの運用管理